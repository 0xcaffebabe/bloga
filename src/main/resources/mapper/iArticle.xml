<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wang.ismy.bloga.dao.inter.IArticle">
    <delete id="deleteArticle" parameterType="int">
        DELETE FROM article
        WHERE id=#{id}
    </delete>

    <update id="updateArticle" parameterType="wang.ismy.bloga.entity.Article">
        UPDATE article
        <set>
            <if test="title!=null &amp;&amp; !&quot;&quot;.equals(title)">
                title=#{title},
            </if>
            <if test="content!=null &amp;&amp; !&quot;&quot;.equals(content)">
                content=#{content},
            </if>
            <if test="tags!=null &amp;&amp; !&quot;&quot;.equals(tags)">
                tags=#{tags},
            </if>
            <if test="lastEditTime!=null">
                last_edit_time=#{lastEditTime},
            </if>
        </set>
        WHERE id=#{id}
    </update>

    <select id="getArticlesById" parameterType="int" resultType="wang.ismy.bloga.entity.Article">
         SELECT id,content,create_time,last_edit_time,tags,title,browse_number,
        (SELECT name FROM user where article.user=user.id) user_name
         FROM article WHERE id=#{id}
    </select>

    <select id="getArticlesByPage" parameterType="map" resultType="wang.ismy.bloga.entity.Article">
        SELECT id,content,create_time,last_edit_time,tags,title,browse_number,
        (SELECT name FROM user where article.user=user.id) user_name
         FROM article
        ORDER BY id DESC
        LIMIT #{offset} , #{length}
    </select>
    
    <select id="getRelevantArticles" parameterType="map" resultType="wang.ismy.bloga.entity.Article">
        SELECT id,title
        FROM article
        ORDER BY rand() limit #{length}
    </select>

    <select id="getRecommendArticles" parameterType="int" resultType="wang.ismy.bloga.entity.Article">
        SELECT id,title
        FROM article
        ORDER BY rand() limit #{length}
    </select>
    
    <select id="getFile" resultType="String">
        SELECT CONCAT(YEAR(create_time),'年',MONTH(create_time),'月') file
        FROM article GROUP BY YEAR(create_time),MONTH(create_time)
        ORDER BY create_time desc;
    </select>
</mapper>